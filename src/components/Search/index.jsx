import React from "react";
import debounce from "lodash.debounce";
import { useDispatch } from "react-redux";

import { setSearchValue } from "../../redux/slices/filterSlice";
import styles from "./Search.module";

const Search = () => {
  const dispatch = useDispatch();
  const [value, setValue] = React.useState("");
  const inputRef = React.useRef();

  const onClickClear = () => {
    setValue("");
    dispatch(setSearchValue(""));
    inputRef.current.focus();
  };

  const onChangeInput = (e) => {
    setValue(e.target.value);
    updateSearchValue(e.target.value);
  };

  const updateSearchValue = React.useCallback(
    debounce((str) => {
      dispatch(setSearchValue(str));
    }, 500),
    []
  );
  return (
    <div className={styles.root}>
      <svg
        className={styles.icon}
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 256 256"
      >
        <g>
          <path d="M248.7,219.8C248.7,219.8,248.6,219.8,248.7,219.8l-0.1,0c-0.1-0.2-0.2-0.4-0.4-0.5l-36.5-44.6   c27.1-44.2,20.5-102.2-16.3-139.2C151.3-8.6,79.5-8.8,35.2,35.3c-43.9,44.2-43.8,116,0.4,160c36.9,36.8,94.9,43.5,139.2,16.3   l44.4,36.3c0.2,0.2,0.6,0.6,0.8,0.7c3.9,3.3,8.6,5,13.3,5c4.8,0,9.5-1.7,13.5-5l2-1.9c0.3-0.3,0.6-0.7,0.8-1.1   C255.3,238,255.1,227.3,248.7,219.8z M241,239.8c-0.1,0.1-0.2,0.3-0.3,0.4l-0.8,0.7c-3.9,3.3-9.5,3.3-13.5-0.1l-0.3-0.3   c-0.1-0.1-0.2-0.2-0.4-0.3l-47.4-38.8c-0.9-0.8-2.1-1.2-3.2-1.2c-1,0-2,0.3-2.9,0.9l-0.4,0.3c-40.5,26.5-94.8,20.9-129.1-13.3   C2.6,148.1,2.5,82.8,42.5,42.4C82.7,2.4,148,2.6,188.1,42.7c34.2,34.3,39.8,88.6,13.3,129.1l-0.3,0.5c-1.2,1.9-1.1,4.3,0.3,6   l38.8,47.4l0,0c0.2,0.2,0.4,0.4,0.5,0.6l0.1,0.1C244.2,230.3,244.3,235.9,241,239.8z" />
          <path d="M115.3,179.3c-35.2,0-63.8-28.6-63.8-63.8c0-31.6,22.7-58,53.4-62.9V42.3c-36.5,5.1-63.6,36-63.6,73.2   c0,40.8,33.2,74,74,74c37.2,0,68.2-27.1,73.2-63.6h-10.3C173.3,156.6,146.9,179.3,115.3,179.3z" />
          <path d="M122.8,41.9l-5.6-0.6v72.3h72.3l-0.6-5.6C185.4,73.2,157.6,45.4,122.8,41.9z M127.4,103.4V52.9   c25.5,4.9,45.6,25.1,50.5,50.5H127.4z" />
        </g>
      </svg>
      <input
        ref={inputRef}
        value={value}
        onChange={onChangeInput}
        className={styles.input}
        placeholder="Введите название пиццы"
      />
      {value && (
        <svg
          onClick={onClickClear}
          className={styles.clear}
          height="24"
          viewBox="0 0 24 24"
          width="24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M8,4 L21,4 C22.1045695,4 23,4.8954305 23,6 L23,18 C23,19.1045695 22.1045695,20 21,20 L8,20 C7.49479181,20 7.26688156,19.8135296 6.80345396,19.3176949 C6.75712534,19.2681266 6.7099247,19.2160219 6.66192355,19.1616204 C6.47807387,18.9532567 6.31421472,18.7494307 6.23177872,18.6401844 L0.698291721,12 L1.23177872,11.3598156 L6.18176877,5.42511074 C6.28584987,5.27697368 6.44363308,5.06720208 6.62702438,4.85177708 C6.70024349,4.7657685 6.77251996,4.68522946 6.84400957,4.61079521 C7.22963038,4.20929073 7.51572647,4 8,4 Z M8.14992562,6.14822292 C8.01407942,6.30779792 7.88980013,6.47302632 7.76822128,6.6401844 L3.30164767,12.0000727 L7.79436009,17.3925528 C7.87696028,17.5005693 8.01456988,17.6717433 8.16160145,17.8383796 C8.1974634,17.8790233 8.23193807,17.9170798 8.2646108,17.9520373 C8.28044249,17.9689761 8.29568185,17.9849966 8.31020844,18 L21,18 L21,5.99999999 L8.28281512,6 C8.24198403,6.04270247 8.19723122,6.09265426 8.14992562,6.14822292 Z M14,10.5857864 L16.2928932,8.29289322 L17.7071068,9.70710678 L15.4142136,12 L17.7071068,14.2928932 L16.2928932,15.7071068 L14,13.4142136 L11.7071068,15.7071068 L10.2928932,14.2928932 L12.5857864,12 L10.2928932,9.70710678 L11.7071068,8.29289322 L14,10.5857864 Z"
            fillRule="evenodd"
          />
        </svg>
      )}
    </div>
  );
};

export default Search;
